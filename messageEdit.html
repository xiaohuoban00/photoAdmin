<!DOCTYPE html>
<html>

<head>
    <!-- 页面meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">




    <title>摄影工作室后台管理</title>
    <meta name="description" content="AdminLTE2定制版">
    <meta name="keywords" content="AdminLTE2定制版">




    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">

  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->


    <link rel="stylesheet" href="plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="plugins/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="plugins/iCheck/square/blue.css">
    <link rel="stylesheet" href="plugins/morris/morris.css">
    <link rel="stylesheet" href="plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <link rel="stylesheet" href="plugins/datepicker/datepicker3.css">
    <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="plugins/treeTable/jquery.treetable.css">
    <link rel="stylesheet" href="plugins/treeTable/jquery.treetable.theme.default.css">
    <link rel="stylesheet" href="plugins/select2/select2.css">
    <link rel="stylesheet" href="plugins/colorpicker/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
    <link rel="stylesheet" href="plugins/adminLTE/css/AdminLTE.css">
    <link rel="stylesheet" href="plugins/adminLTE/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="plugins/ionslider/ion.rangeSlider.css">
    <link rel="stylesheet" href="plugins/ionslider/ion.rangeSlider.skinNice.css">
    <link rel="stylesheet" href="plugins/bootstrap-slider/slider.css">
    <link rel="stylesheet" href="plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css">
    <style>
        .w-e-text-container{
            height: 600px !important;
            width: 700px;
        }
    </style>
</head>

<body class="hold-transition skin-purple sidebar-mini">

    <div class="wrapper">
        <!-- 页面头部 -->
        <div id="header"></div>
        <!-- 页面头部 /-->

        <!-- 导航侧栏 -->
        <div id="aside"></div>
        <!-- 导航侧栏 /-->

        <!-- 内容区域 -->
        <div class="content-wrapper">

            <!-- 内容头部 -->
            <section class="content-header">
                <h1>
                    消息编辑
                </h1>
                <ol class="breadcrumb">
                    <li><a href="all-admin-index.html"><i class="fa fa-dashboard"></i> 首页</a></li>
                    <li class="active">消息编辑</li>
                </ol>
            </section>
            <!-- 内容头部 /-->

            <!-- 正文区域 -->
            <section class="content">

                <div class="box-body">

                    <!--tab页-->
                    <div class="nav-tabs-custom">

                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#fa-icons" data-toggle="tab">消息推送</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="fa-icons">
                                <div class="box-body" >
                                    <div style="display: flex;margin: 10px">
                                        <div>
                                            <label style="flex-basis: 30px">消息名:</label>
                                        </div>
                                        <div class="" style="flex: 2;margin-left: 10px;">
                                            <input type="text" class="form-control" id="title"  placeholder="消息名">
                                        </div>
                                    </div>
                                    <label>封面图片</label>
                                    <input type="file" id="image" accept="image/gif, image/jpeg, image/png, image/jpg">
                                    <img src="" id="img">
                                    <div class="form-group">
                                        <label>状态</label>
                                        <input type="text" class="form-control" placeholder="状态" id="status" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>操作者Id</label>
                                        <input type="text" class="form-control" placeholder="操作者Id" id="AdminId" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>操作者名字</label>
                                        <input type="text" class="form-control" placeholder="操作者名字" id="AdminName" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>创建时间</label>
                                        <input type="text" class="form-control" placeholder="创建时间" id="createTime" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>发送时间</label>
                                        <input type="text" class="form-control" placeholder="发送时间" id="sendTime" disabled>
                                    </div>
                                    <div style="text-align: center;">
                                        <div id="div1" class="w-e-text-container">
                                        </div>
                                    </div>
                                </div>
                                <div class="box-tools" style="margin-top: 40px;margin-left: 300px" id="btu">
                                    <button type="button" class="btn bg-maroon" id="sub">推送</button>
                                    <button type="button" class="btn bg-maroon" id="save">保存</button>
                                </div>
                            </div>
                        </div>
                        <!-- /.tab-content -->
                    </div>

                    <!--tab页/-->


                    <!-- .box-footer
        <div class="box-footer"></div>
        -->
                    <!-- /.box-footer-->

                </div>

            </section>
            <!-- 正文区域 /-->

        </div>
        <!-- 内容区域 /-->



    </div>


    <script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
    <script src="plugins/jQueryUI/jquery-ui.min.js"></script>
    <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script>
    <script src="plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="plugins/raphael/raphael-min.js"></script>
    <script src="plugins/morris/morris.min.js"></script>
    <script src="plugins/sparkline/jquery.sparkline.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="plugins/knob/jquery.knob.js"></script>
    <script src="plugins/daterangepicker/moment.min.js"></script>
    <script src="plugins/daterangepicker/daterangepicker.js"></script>
    <script src="plugins/daterangepicker/daterangepicker.zh-CN.js"></script>
    <script src="plugins/datepicker/bootstrap-datepicker.js"></script>
    <script src="plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
    <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="plugins/fastclick/fastclick.js"></script>
    <script src="plugins/iCheck/icheck.min.js"></script>
    <script src="plugins/adminLTE/js/app.min.js"></script>
    <script src="plugins/treeTable/jquery.treetable.js"></script>
    <script src="plugins/select2/select2.full.min.js"></script>
    <script src="plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
    <script src="plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.zh-CN.js"></script>
    <script src="plugins/bootstrap-markdown/js/bootstrap-markdown.js"></script>
    <script src="plugins/bootstrap-markdown/locale/bootstrap-markdown.zh.js"></script>
    <script src="plugins/bootstrap-markdown/js/markdown.js"></script>
    <script src="plugins/bootstrap-markdown/js/to-markdown.js"></script>
    <script src="plugins/input-mask/jquery.inputmask.js"></script>
    <script src="plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
    <script src="plugins/input-mask/jquery.inputmask.extensions.js"></script>
    <script src="plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="plugins/datatables/dataTables.bootstrap.min.js"></script>
    <script src="plugins/chartjs/Chart.min.js"></script>
    <script src="plugins/flot/jquery.flot.min.js"></script>
    <script src="plugins/flot/jquery.flot.resize.min.js"></script>
    <script src="plugins/flot/jquery.flot.pie.min.js"></script>
    <script src="plugins/flot/jquery.flot.categories.min.js"></script>
    <script src="plugins/ionslider/ion.rangeSlider.min.js"></script>
    <script src="plugins/bootstrap-slider/bootstrap-slider.js"></script>
    <script src="plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
    <script src="plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="plugins/wangEditor-3.1.1/release/wangEditor.min.js"></script>
    <script src="plugins/common.js"></script>
    <script type="text/javascript">
        $("#header").load("header.html");
        $("#aside").load("aside.html");
        var E = window.wangEditor;
        var editor = new E('#div1');
        // 下面两个配置，使用其中一个即可显示“上传图片”的tab。但是两者不要同时使用！！！
        editor.customConfig.uploadImgServer = ipAddr+'/upload';  // 上传图片到服务器
        editor.customConfig.uploadImgMaxSize = 30 * 1024 * 1024;
        editor.customConfig.uploadImgMaxLength = 1;
        // 隐藏“网络图片”tab
        editor.customConfig.showLinkImg = false;
        // 关闭粘贴内容中的样式
        editor.customConfig.pasteFilterStyle = false;
        // 忽略粘贴内容中的图片
        editor.customConfig.pasteIgnoreImg = false;
        editor.customConfig.uploadFileName = 'image';
        editor.customConfig.uploadImgTimeout = 1000;
        editor.customConfig.uploadImgHooks = {
            // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
            // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
            customInsert: function (insertImg, result, editor) {
                // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
                // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果
                // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
                var url = result.url[0];
                insertImg(url)
                // result 必须是一个 JSON 格式字符串！！！否则报错
            }
        };
        editor.customConfig.menus = [
            'head',  // 标题
            'bold',  // 粗体
            'fontSize',  // 字号
            'fontName',  // 字体
            'italic',  // 斜体
            'underline',  // 下划线
            'strikeThrough',  // 删除线
            'link',  // 插入链接
            'list',  // 列表
            'justify',  // 对齐方式
            'quote',  // 引用
            'emoticon',  // 表情
            'image',  // 插入图片
            'table',  // 表格
            'video',  // 插入视频
            'code',  // 插入代码
            'undo',  // 撤销
            'redo'  // 重复
        ];
        editor.create();
    </script>
    <script type="text/javascript">
        var image = $("#image");
        var st;
        var s;
        $(function () {
            $.ajax({
                url:ipAddr+"/message/selectMessageById",
                data:{
                    id:getParameter("id")
                },
                type:"get",
                dataType:"json",
                async:false,
                xhrFields: {
                    withCredentials: true //允许跨域带Cookie
                },
                success:function (data) {
                    $("#title").val(data.title);
                    $("#img").attr("style","width:200px;heigth:400");
                    $("#img").attr("src",data.image);
                    var status = data.status==1?"草稿":"已发送";
                    s=data.image;
                    st=data.status;
                    $("#status").val(status);
                    $("#AdminId").val(data.adminInfo.id)
                    $("#AdminName").val(data.adminInfo.username);
                    $("#createTime").val(mill2date(data.createTime));
                    var sendTime = data.sendTime==null?"无":mill2date(data.sendTime);
                    $("#sendTime").val(sendTime);
                    editor.txt.html(data.content);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (XMLHttpRequest.status == 403) {
                        alert("权限不足");
                        location.href = "index.html"
                    }
                }
            })
            image.on('change',function () {
                var src = add("#image");
                $("#img").attr("style","width:200px;heigth:400");
                $("#img").attr("src",src);
                s=src;
                console.log(s);
            });
            $("#sub").click(function () {
                var txt = editor.txt.html();
                if($("#title").val()==""){
                    alert("标题不能为空");
                    return;
                }
                if(st==2){
                    alert("已发送消息不可编辑");
                    return;
                }
                $.ajax({
                    url:ipAddr+"/message/insertMessage",
                    data:{
                        id:getParameter("id"),
                        title:$("#title").val(),
                        content:txt,
                        status:2,
                        adminId:adminInfo.id,
                        image:s
                    },
                    async:false,
                    type:"post",
                    dataType:"json",
                    xhrFields: {
                        withCredentials: true //允许跨域带Cookie
                    },
                    success:function (flag) {
                        if(flag){
                            alert("发送成功");
                            location.reload();
                        }else {
                            alert("发送失败")
                        }
                    }
                })
            });
            $("#save").click(function () {
                var txt = editor.txt.html();
                if($("#title").val()==""){
                    alert("标题不能为空");
                    return;
                }
                if(st==2){
                    alert("已发送消息不可编辑");
                    return;
                }
                $.ajax({
                    url:ipAddr+"/message/insertMessage",
                    data:{
                        id:getParameter("id"),
                        title:$("#title").val(),
                        content:txt,
                        status:1,
                        adminId:adminInfo.id,
                        image:s
                    },
                    async:false,
                    type:"post",
                    dataType:"json",
                    xhrFields: {
                        withCredentials: true //允许跨域带Cookie
                    },
                    success:function (flag) {
                        if(flag){
                            alert("保存成功");
                            location.reload();
                        }else {
                            alert("保存失败")
                        }
                    }
                })
            });
        });
    </script>
    <script>
        $(document).ready(function() {
            // 选择框
            $(".select2").select2();

            // WYSIHTML5编辑器
            $(".textarea").wysihtml5({
                locale: 'zh-CN'
            });
        });


        // 设置激活菜单
        function setSidebarActive(tagUri) {
            var liObj = $("#" + tagUri);
            if (liObj.length > 0) {
                liObj.parent().parent().addClass("active");
                liObj.addClass("active");
            }
        }


        $(document).ready(function() {
            // 激活导航位置
            setSidebarActive("travellog-setting");
        });

    </script>
</body>

</html>